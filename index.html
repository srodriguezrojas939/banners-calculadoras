<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Creador de Iconos de Calculadora</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --bg-calc: #efefef;
            --border-outer: #dcdcdc;
            --screen-bg: #ffffff;
            --keypad-bg: #e0e0e0; /* Gris un poco más oscuro */
            --btn-black: #1a1a1a;
            --gap: 12px; /* Espaciado uniforme */
        }

        body {
            background: #f0f2f5;
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        /* Contenedor Cuadrado de Exportación */
        #export-container {
            width: 512px;
            height: 512px;
            background: white; 
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        /* Cuerpo de la Calculadora */
        .calculator {
            width: 360px;
            background: var(--bg-calc);
            border: 2px solid var(--border-outer);
            border-radius: 60px;
            padding: 35px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        /* Pantalla con auto-ajuste */
        .screen {
            background: var(--screen-bg);
            border: 2px solid #e5e5e5;
            border-radius: 30px;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            overflow: hidden; /* Importante para el auto-scale */
            position: relative;
        }

        /* Contenedor interno que escala la fórmula */
        #math-wrapper {
            transition: transform 0.2s ease;
            transform-origin: center;
            white-space: nowrap;
        }

        /* Teclado Compacto */
        .keypad {
            background: var(--keypad-bg);
            border-radius: 35px;
            padding: var(--gap); /* Distancia al borde igual al gap entre botones */
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--gap);
        }

        /* Botones Squircles Grandes */
        .btn {
            background: var(--btn-black);
            aspect-ratio: 1 / 1;
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            font-weight: 600;
        }

        /* Botón Igual */
        .btn-equal {
            grid-column: 3;
            grid-row: 1 / span 2;
            aspect-ratio: auto;
            height: 100%;
        }

        /* UI de Control */
        .ui {
            margin-top: 30px;
            width: 450px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        textarea {
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #ccc;
            font-family: monospace;
            resize: vertical;
        }

        .download-btn {
            background: #000;
            color: #fff;
            border: none;
            padding: 18px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
        }

        .download-btn:hover { background: #333; }
    </style>
</head>
<body>

    <div id="export-container">
        <div class="calculator">
            <div class="screen">
                <div id="math-wrapper">
                    <div id="latex-render"></div>
                </div>
            </div>
            
            <div class="keypad">
                <div class="btn">+</div>
                <div class="btn">-</div>
                <div class="btn btn-equal">=</div>
                <div class="btn">×</div>
                <div class="btn">÷</div>
            </div>
        </div>
    </div>

    <div class="ui">
        <label>Fórmula LaTeX:</label>
        <textarea id="latex-input" rows="3">\frac{A_1}{ax+b} + \frac{A_2}{(ax+b)^2} + \dots</textarea>
        <button class="download-btn" onclick="downloadPNG()">Descargar Icono PNG Alta Calidad</button>
    </div>

    <script>
        const input = document.getElementById('latex-input');
        const render = document.getElementById('latex-render');
        const wrapper = document.getElementById('math-wrapper');
        const screen = document.querySelector('.screen');

        function updateMath() {
            // 1. Renderizar la fórmula
            katex.render(input.value, render, {
                throwOnError: false,
                displayMode: true
            });

            // 2. Auto-ajustar tamaño (Shrink to fit)
            setTimeout(() => {
                const padding = 40; // Margen interno de seguridad
                const availableWidth = screen.offsetWidth - padding;
                const formulaWidth = render.offsetWidth;
                
                if (formulaWidth > availableWidth) {
                    const scale = availableWidth / formulaWidth;
                    wrapper.style.transform = `scale(${scale})`;
                } else {
                    wrapper.style.transform = `scale(1)`;
                }
            }, 50);
        }

        input.addEventListener('input', updateMath);
        window.addEventListener('load', updateMath);

        function downloadPNG() {
            const container = document.getElementById('export-container');
            
            html2canvas(container, {
                backgroundColor: null,
                scale: 4, // Ultra alta definición
                logging: false,
                useCORS: true
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'icon-calculadora-latex.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }
    </script>
</body>
</html>
